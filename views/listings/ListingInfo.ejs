<% layout("/layouts/boilerplate") %>

    <body class="listing-info">
        <div class="listing-info-container">
            <div class="listing-info-img">
                <img src="<%= image.url %>" style="border-radius: 12px;" />
            </div>
            <div class="listing-info-content " >
                <div class="listing-info-text flex-1" >
                    <p class="listing-info-heading">
                        <%= title %>
                    </p>

                    <div class="flex items-center gap-2 listing-info-location-text">
                        <i class="fa-solid fa-location-dot" style="color: #737373;"></i>
                        <span>
                            <span>
                                <%= location %>,
                            </span>
                            <span>
                                <%= country %>
                            </span>
                        </span>
                    </div>
                    <div class="listing-owner-container"  style="color: #737373;">
                        <i class="fa-solid fa-user"></i>
                        <span class="listed-by">Listed By : </span>
                        <span class="listed-by-name"><%= owner.username %> </span>
                    </div>

                    <div class="listing-info-desc ">Description</div>

                    <p class="listing-info-desc-text">
                        <%= description %>
                    </p>

                    <div class="flex mt-6 mb-4 items-center justify-between">
                        <h3 class="review-form-heading ">Reviews</h3>
                        <div class="all-review-container">
                            <i class="fa-solid fa-star review-star"></i>
                            <p class="avg-reviews-text-value ">
                                <% const avg = reviews && reviews.length 
                                ? ((reviews || []).reduce((sum, item) => sum + item.rating , 0)/ reviews.length ).toFixed(1) 
                                : null
                                %>
                                <%= avg ? avg : "" %>
                            </p>
                            <p class="avg-reviews-text"> ( <%= reviews.length %> reviews ) </p>
                        </div>
                        
                    </div>
                    <% if(currentUser && !owner._id.equals(currentUser._id)) { %> 
                        <%- include("../reviews/Reviews.ejs", { listingId: _id }) %>
                    <% } %>

                    <%- include("../reviews/ReviewsList.ejs", { reviews : reviews.reverse(), listingId : _id }) %>

                </div>
                <div class="listing-info-right">
                    <div>
                        <span class="listing-info-right-price"> &#8377; <%= price.toLocaleString("en-In") %></span>
                        <span class="listing-info-right-price-text">/night</span>
                        <hr style="color: hsl(0 0% 89.8%); margin-bottom: 10px; margin-top: 10px;">
                    </div>

                    <% if(currentUser && owner._id.equals(currentUser._id)) { %>

                    <form action="/listings/<%= _id %>/edit" method="get">
                        <button class="submit-button" style="width: 100%;">Edit</button>
                    </form>

                    <form action="/listings/<%= _id %>?_method=DELETE" method="post">
                        <button class="discard-button" style="width: 100%;"> Delete </button>
                    </form>

                    <% } %>
                </div>

            </div>


        </div>
    </body>